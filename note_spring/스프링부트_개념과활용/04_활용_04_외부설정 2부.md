# 외부 설정 2부

타입-세이프 프로퍼티 @ConfigurationProperties

- 여러 프로퍼티를 묶어서 읽어올 수 있음
- 빈으로등록해서다른빈에주입할수있음
  - @EnableConfigurationProperties
  - **@Component**
  - @Bean
- 융통성 있는 바인딩
  - context-path (케밥)
  - context_path (언드스코어)
  - contextPath (캐멀)
  - CONTEXTPATH
- 프로퍼티 타입 컨버전
  - @DurationUnit
- 프로퍼티 값 검증
  - @Validated
  - JSR-303 (@NotNull, ...)
- 메타정보생성

* @Value
  * SpEL 을 사용할 수 있지만...
  * 위에 있는 기능들은 전부 사용 못합니다.

---

# 타입-세이프 프로퍼티 @ConfigurationProperties

#### 같은 키로 시작하는 외부 설정의 경우 묶어서 하나의 빈으로 등록할 수 있다.

1. 빈으로 만들 클래스를 하나 생성

2. 속성 key 값들을 변수로 선언

3. Getter, Setter 추가

   * 자바 빈 스펙을 따라서 (properties 값을 클래스 변수에) 자동으로 바인딩을 해주기 때문에 

4. `@ConfigurationProperties(key값)` 어노테이션 추가

   * "Configuration Annotation Processor not configured" 에러 

     ⇒ 이 어노테이션이 달려있는 클래스를 분석해서 메타정보를 만들 수 있다.

     properties에서 자동완성기능은 메타정보를 기반으로 해서 이루어진다.

     프로젝트를 빌드할 때 이러한 메타정보를 생성해주는 플러그인을 추가하라고 알려주는 것이다.

5. 플러그인 의존성 추가

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-configuration-processor</artifactId>
    <optional>true</optional>
</dependency>
```

소스코드

```java
import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.stereotype.Component;

@Component
@ConfigurationProperties("person")
public class PersonProperties {

    private String name;

    private int age;

    private String fullName;

    public String getName() {
        return name;
    }

    // ... getter , setter 추가 ...
}
```



6. 바인딩한 값을 사용할 수 있도록 빈으로 등록 (기본설정으로 이미 활성화되어있음)

* `@EnableConfigurationProperties(Configuration properties 클래스)` 어노테이션 추가

Configuration Properties 에 대한 목록을 지정해줘야 한다.

빈으로 등록해주고 `@ConfigurationProperties`어노테이션을 처리해준다.

```java
@SpringBootApplication
@EnableConfigurationProperties(PersonProperties.class) // <-- 목록 추가
public class SpringinitApplication {

    public static void main(String[] args) {
        SpringApplication app = new SpringApplication(SpringinitApplication.class);
        app.run(args);
    }
}
```

* `@Component` 어노테이션 추가 : PersonProperties클래스를 빈으로 등록

```java
@Component //<-- 빈으로 등록
@ConfigurationProperties("person")
public class PersonProperties { ... }
```



#### 빈으로 등록한 외부 설정 사용하기

* `@Autowired`로 빈을 주입받아서 사용

```java
@Component
public class SampleRunner implements ApplicationRunner {

    @Autowired
    PersonProperties personProperties;

    @Override
    public void run(ApplicationArguments args) throws Exception {
        System.out.println("=============================");
        System.out.println(personProperties.getFullName());
        System.out.println(personProperties.getAge());
        System.out.println("=============================");
    }
}
```

```
=============================
Bolar Kim
23
=============================
```









 















